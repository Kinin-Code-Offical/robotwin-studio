<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>RobotWin Debug Console</title>
    <link rel="icon" type="image/svg+xml" href="favicon.svg" />
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <header class="hero">
      <div class="hero-inner">
        <div class="hero-title">
          <div>
            <h1>RobotWin Debug Console</h1>
            <p>Unified observability for sim, firmware, physics, and toolchain.</p>
          </div>
          <div class="hero-actions">
            <button id="downloadSnapshot" class="ghost">Download Snapshot</button>
          </div>
        </div>
        <div class="hero-toolbar">
          <div class="toolbar-group">
            <span class="muted">Auto Refresh</span>
            <label class="switch">
              <input id="autoRefreshToggle" type="checkbox" checked />
              <span class="slider"></span>
            </label>
            <label class="toolbar-field">
              Interval (sec)
              <input id="refreshInterval" type="number" min="2" max="30" value="4" />
            </label>
          </div>
          <div class="toolbar-group">
            <span class="muted">Log Scan</span>
            <label class="toolbar-field">
              Tail lines
              <input id="logScanTail" type="number" min="50" max="2000" value="400" />
            </label>
            <button id="refreshAlerts">Refresh Alerts</button>
          </div>
          <div class="toolbar-group status-inline">
            <span class="muted">Last Update</span>
            <strong id="lastUpdate">--</strong>
            <span class="muted">Unity</span>
            <strong id="unityLatency">N/A</strong>
          </div>
        </div>
      </div>
    </header>

    <main class="layout">
      <section class="panel">
        <h2>System Overview</h2>
        <div class="status-grid">
          <div class="status-card">
            <span>Server Time</span>
            <strong id="systemTime">N/A</strong>
          </div>
          <div class="status-card">
            <span>Platform</span>
            <strong id="systemPlatform">N/A</strong>
          </div>
          <div class="status-card">
            <span>Python</span>
            <strong id="systemPython">N/A</strong>
          </div>
          <div class="status-card">
            <span>Repo</span>
            <strong id="systemRepo">N/A</strong>
          </div>
          <div class="status-card">
            <span>Logs Size</span>
            <strong id="systemLogsSize">N/A</strong>
          </div>
          <div class="status-card">
            <span>Builds Size</span>
            <strong id="systemBuildsSize">N/A</strong>
          </div>
          <div class="status-card">
            <span>Unity Base URL</span>
            <strong id="systemUnityUrl">N/A</strong>
          </div>
          <div class="status-card">
            <span>Console Uptime</span>
            <strong id="systemUptime">N/A</strong>
          </div>
        </div>
        <div class="telemetry-controls">
          <label>
            Notes
            <input id="systemNotes" type="text" placeholder="Session notes (local only)" />
          </label>
          <button id="saveNotes">Save</button>
        </div>
      </section>

      <section class="panel">
        <h2>Alerts & Event Feed</h2>
        <div class="telemetry-controls">
          <label>
            Filter
            <input id="alertFilter" type="text" placeholder="error, warning, subsystem" />
          </label>
          <button id="clearAlerts" class="ghost">Clear Feed</button>
        </div>
        <div class="alert-list">
          <ul id="alertList"></ul>
        </div>
        <div class="output">
          <div class="output-header">
            <span>Alert Detail</span>
          </div>
          <pre id="alertDetail">Select an alert to view context.</pre>
        </div>
      </section>

      <section class="panel">
        <h2>Simulation Status</h2>
        <div class="status-grid">
          <div class="status-card">
            <span>Unity</span>
            <strong id="unityConnected">Disconnected</strong>
          </div>
          <div class="status-card">
            <span>Engine</span>
            <strong id="engineStatus">Unknown</strong>
          </div>
          <div class="status-card">
            <span>Scene</span>
            <strong id="sceneName">N/A</strong>
          </div>
          <div class="status-card">
            <span>Run Mode</span>
            <strong id="runMode">N/A</strong>
          </div>
          <div class="status-card">
            <span>Sim Running</span>
            <strong id="simRunning">N/A</strong>
          </div>
          <div class="status-card">
            <span>Tick</span>
            <strong id="simTick">0</strong>
          </div>
          <div class="status-card">
            <span>Time (s)</span>
            <strong id="simTime">0.00</strong>
          </div>
          <div class="status-card">
            <span>Signals</span>
            <strong id="signalCount">0</strong>
          </div>
          <div class="status-card">
            <span>Validation</span>
            <strong id="validationCount">0</strong>
          </div>
          <div class="status-card">
            <span>Avg Jitter (ms)</span>
            <strong id="simAvgJitter">0.000</strong>
          </div>
          <div class="status-card">
            <span>Max Jitter (ms)</span>
            <strong id="simMaxJitter">0.000</strong>
          </div>
          <div class="status-card">
            <span>Avg Tick (ms)</span>
            <strong id="simAvgTick">0.000</strong>
          </div>
          <div class="status-card">
            <span>Overruns</span>
            <strong id="simOverruns">0</strong>
          </div>
          <div class="status-card">
            <span>Fast Path</span>
            <strong id="simFastPath">0</strong>
          </div>
          <div class="status-card">
            <span>Corrective</span>
            <strong id="simCorrective">0</strong>
          </div>
          <div class="status-card">
            <span>Budget Overruns</span>
            <strong id="simBudgetOverruns">0</strong>
          </div>
        </div>
        <div class="telemetry-controls">
          <label>
            Filter
            <input id="telemetryFilter" type="text" placeholder="Component id/type" />
          </label>
          <button id="refreshTelemetry">Refresh</button>
        </div>
        <div class="telemetry-list">
          <ul id="telemetryList"></ul>
        </div>
        <h3 class="subheading">Firmware Perf</h3>
        <div class="telemetry-list">
          <ul id="firmwarePerfList"></ul>
        </div>
        <h3 class="subheading">Hotspots</h3>
        <div class="telemetry-list">
          <ul id="hotspotList"></ul>
        </div>
      </section>

      <section class="panel">
        <h2>CoreSim &lt;-&gt; NativeEngine Bridge</h2>
        <div class="bridge-grid">
          <div class="bridge-card">
            <span>Ready</span>
            <strong id="bridgeReady">false</strong>
          </div>
          <div class="bridge-card">
            <span>Running</span>
            <strong id="bridgeRunning">false</strong>
          </div>
          <div class="bridge-card">
            <span>Native Enabled</span>
            <strong id="bridgeNative">false</strong>
          </div>
          <div class="bridge-card">
            <span>Native Pins</span>
            <strong id="bridgeNativePins">false</strong>
          </div>
          <div class="bridge-card">
            <span>Firmware Enabled</span>
            <strong id="bridgeFirmware">false</strong>
          </div>
          <div class="bridge-card">
            <span>Firmware Host</span>
            <strong id="bridgeFirmwareHost">RoboTwinFirmwareHost.exe</strong>
          </div>
          <div class="bridge-card">
            <span>Firmware Mode</span>
            <strong id="bridgeFirmwareMode">lockstep</strong>
          </div>
          <div class="bridge-card">
            <span>Firmware Pipe</span>
            <strong id="bridgeFirmwarePipe">RoboTwin.FirmwareEngine</strong>
          </div>
          <div class="bridge-card">
            <span>Firmware Sessions</span>
            <strong id="bridgeFirmwareSessions">0</strong>
          </div>
          <div class="bridge-card">
            <span>Virtual Boards</span>
            <strong id="bridgeVirtualBoards">0</strong>
          </div>
          <div class="bridge-card">
            <span>Powered Boards</span>
            <strong id="bridgePoweredBoards">0</strong>
          </div>
          <div class="bridge-card">
            <span>Signals</span>
            <strong id="bridgeSignals">0</strong>
          </div>
          <div class="bridge-card">
            <span>Validation</span>
            <strong id="bridgeValidation">0</strong>
          </div>
          <div class="bridge-card">
            <span>Physics Running</span>
            <strong id="bridgePhysicsRunning">false</strong>
          </div>
          <div class="bridge-card">
            <span>Physics Bodies</span>
            <strong id="bridgePhysicsBodies">0</strong>
          </div>
        </div>
        <div class="telemetry-controls">
          <label>
            Firmware Mode
            <select id="firmwareModeSelect">
              <option value="lockstep">lockstep</option>
              <option value="realtime">realtime</option>
            </select>
          </label>
          <button id="firmwareModeApply">Apply</button>
          <span id="firmwareModeStatus" class="muted"></span>
        </div>
        <div class="bridge-contract">
          <div>
            <h3>ControlFrame</h3>
            <ul id="bridgeControlKeys"></ul>
          </div>
          <div>
            <h3>PhysicsFrame</h3>
            <ul id="bridgePhysicsKeys"></ul>
          </div>
        </div>
        <div class="bridge-note" id="bridgeNote">Waiting for Unity bridge...</div>
      </section>
      <section class="panel">
        <h2>Test Runner</h2>
        <div id="testList" class="test-grid"></div>
        <div class="telemetry-controls">
          <label>
            History
            <input id="testHistoryFilter" type="text" placeholder="filter history" />
          </label>
          <button id="clearHistory" class="ghost">Clear History</button>
        </div>
        <div class="test-history">
          <ul id="testHistory"></ul>
        </div>
        <div class="output">
          <div class="output-header">
            <span>Latest Output</span>
            <button id="clearOutput" class="ghost">Clear</button>
          </div>
          <pre id="testOutput">Select a test to run.</pre>
        </div>
      </section>

      <section class="panel">
        <h2>Log Browser</h2>
        <div class="log-controls">
          <label>
            Area
            <select id="logArea">
              <option value="debug_console">debug_console</option>
              <option value="unity">unity</option>
              <option value="firmware">firmware</option>
              <option value="native">native</option>
              <option value="tools">tools</option>
            </select>
          </label>
          <label>
            Tail lines
            <input id="logTail" type="number" min="50" max="2000" value="400" />
          </label>
          <label>
            Search
            <input id="logSearch" type="text" placeholder="text / error / warn" />
          </label>
          <button id="refreshLogs">Refresh</button>
        </div>
        <div class="log-list">
          <ul id="logList"></ul>
        </div>
        <div class="output">
          <div class="output-header">
            <span>Log Preview</span>
          </div>
          <pre id="logOutput">Select a log file.</pre>
        </div>
      </section>

      <section class="panel">
        <h2>COM Ports</h2>
        <div class="log-controls">
          <button id="refreshPorts">Refresh</button>
        </div>
        <div class="port-list">
          <ul id="portList"></ul>
        </div>
      </section>
    </main>

    <footer class="footer">
      <span>Local-only dashboard. Outputs are written to logs/debug_console.</span>
    </footer>

    <script src="app.js"></script>
  </body>
</html>
